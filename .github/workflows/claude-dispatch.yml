# IMPORTANT: Do not move this file in your repo! Make sure it's located at .github/workflows/claude-dispatch.yml
name: Claude Code Dispatch

# IMPORTANT: Do not modify this `on` section!
on:
  repository_dispatch:
    types: [claude-dispatch]

jobs:
  claude-dispatch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write 
      issues: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      # - name: Preliminary Setup
        # run: |
          # echo "Setting up environment..."
          # Add any preliminary setup commands here to setup Claude's dev environment
          # e.g., npm install, etc.

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@eap
        with:
          mode: 'remote-agent'
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

          # Optional: Specify model (defaults to Claude Sonnet 4, uncomment for Claude Opus 4)
          model: 'claude-opus-4-1-20250805'

          # Optional: Allow Claude to run specific commands
          allowed_tools: |
            Bash(npm run lint)
            Bash(npm run test)
            Bash(npm run build)
            Bash(git add:*)
            Bash(git commit:*)
            Bash(git status)
            Bash(git diff:*)
            Bash(git log:*)
            Bash(git config:*)
            Bash(git push:*)
            Bash(npx tsc:*)

          # Optional: Custom environment variables for Claude
          # claude_env: |
          #   NODE_ENV: testiables for Claude
          # claude_env: |
          #   NODE_ENV: test
